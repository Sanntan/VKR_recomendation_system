# Индивидуальное ранжирование на основе компетенций

## Обзор

Система индивидуального ранжирования мероприятий на основе компетенций студентов позволяет персонализировать рекомендации, учитывая:

- **Специальность студента** (направление подготовки)
- **Компетенции студента** с т-баллами (200-800)
  - **Мотиваторы (600-800)**: Сильные стороны, конкурентные преимущества
  - **Нейтральные (400-599)**: Потенциал для развития
  - **Демотиваторы (200-399)**: Зоны развития, требуют дополнительной работы

**Важно:** Компетенции не сохраняются в базе данных. Они используются только для генерации векторизованного профиля студента, который сохраняется в поле `profile_embedding`.

## Архитектура

### 1. Генерация профиля

Модуль `src/recommendation/students/profile_generator.py` преобразует компетенции в текстовое описание профиля, которое включает:

- Специальность
- Сильные стороны (мотиваторы)
- Зоны развития (демотиваторы)
- Компетенции со средним уровнем развития

### 2. Векторизация

Текстовое описание профиля векторизуется с помощью той же модели `SentenceTransformer`, что используется для мероприятий:

- Модель: `sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2`
- Размерность вектора: 384
- Нормализация: Да (для cosine similarity)
- Хранение: Вектор сохраняется в поле `profile_embedding` таблицы `students`

### 3. Ранжирование

Рекомендации рассчитываются через cosine similarity между вектором профиля студента (`profile_embedding`) и вектором мероприятия (`vector_embedding`).

## Использование API

### Обновление профильного вектора на основе компетенций

```http
PUT /students/{student_id}/profile
Content-Type: application/json

{
  "competencies": {
    "Анализ информации": 650,
    "Планирование": 720,
    "Коммуникация": 350,
    "Лидерство": 450,
    "Креативность": 680
  },
  "specialty": "Информационные технологии"
}
```

**Параметры:**

- `competencies` (обязательный): Словарь компетенций `{название: т-балл (200-800)}`. Используется для генерации вектора профиля.
- `specialty` (опциональный): Название специальности. Если указано, обновит направление студента и будет использовано при генерации вектора профиля.

**Ответ:**

```json
{
  "id": "uuid",
  "participant_id": "student_001",
  "institution": "Тюменский государственный университет",
  "direction": {
    "id": "uuid",
    "title": "Информационные технологии",
    "cluster_id": "uuid"
  },
  "created_at": "2024-01-01T00:00:00"
}
```

**Примечание:** После обновления профиля автоматически:
1. Генерируется новый вектор профиля на основе компетенций
2. Вектор сохраняется в поле `profile_embedding`
3. Пересчитываются рекомендации для студента

**Важно:** Компетенции не сохраняются в базе данных. Они используются только для генерации вектора профиля.

### Получение студента

```http
GET /students/{student_id}
```

**Ответ:** Содержит информацию о студенте, включая направление подготовки. Поле `profile_embedding` содержит векторизованный профиль студента, но не возвращается в ответе API.

## Пример использования

### Python (API)

```python
import requests

# Обновление профильного вектора на основе компетенций
student_id = "uuid-студента"
api_url = f"http://localhost:8000/students/{student_id}/profile"

profile_data = {
    "competencies": {
        "Анализ информации": 650,
        "Планирование": 720,
        "Коммуникация": 350,
        "Лидерство": 450,
        "Креативность": 680,
        "Эмоциональный интеллект": 580,
        "Стрессоустойчивость": 420
    },
    "specialty": "Информационные технологии"
}

response = requests.put(api_url, json=profile_data)
student = response.json()

print(f"Профиль обновлен для студента {student['participant_id']}")
print(f"Направление: {student['direction']['title'] if student['direction'] else 'Не указано'}")
```

### Python (CRUD функции)

```python
from src.core.database.crud.students import update_student_profile_embedding_from_competencies
from src.core.database.connection import get_db

# Обновление профильного вектора на основе компетенций
db = next(get_db())
student = update_student_profile_embedding_from_competencies(
    db=db,
    student_id=student_id,
    competencies={
        "Анализ информации": 650,
        "Планирование": 720,
        "Коммуникация": 350
    },
    specialty="Информационные технологии"
)

# Вектор профиля сохранен в student.profile_embedding
# Компетенции не сохраняются в БД
```

## Список компетенций

Поддерживаемые компетенции:

1. Анализ информации
2. Планирование
3. Ориентация на результат
4. Стрессоустойчивость
5. Партнерство/Сотрудничество
6. Следование правилам и процедурам
7. Саморазвитие
8. Лидерство
9. Эмоциональный интеллект
10. Клиентоориентированность
11. Коммуникация
12. Пассивный словарный запас
13. Автономия
14. Альтруизм
15. Вызов
16. Заработок
17. Карьера
18. Креативность
19. Отношения
20. Признание
21. Принадлежность
22. Смысл
23. Сотрудничество
24. Стабильность
25. Традиция
26. Управление
27. Условия труда

## Производительность

- Векторизация профиля: ~50-100ms на студента
- Пересчет рекомендаций: зависит от количества мероприятий
- Обновление профиля: автоматически генерирует вектор профиля и пересчитывает рекомендации

## Важные замечания

1. **Компетенции не сохраняются в БД**: Они используются только для генерации вектора профиля
2. **Вектор профиля**: Сохраняется в поле `profile_embedding` таблицы `students`
3. **Автоматический пересчет**: После обновления профиля автоматически пересчитываются рекомендации
4. **Миграция БД не требуется**: Поле `profile_embedding` уже существует в таблице `students`

## Будущие улучшения

1. Взвешенное ранжирование с учетом мотиваторов
2. Фильтрация мероприятий по типам компетенций
3. Аналитика развития компетенций
4. Рекомендации по развитию компетенций
